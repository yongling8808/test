<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<title>PUSH DEMO</title>
</head>
<body>
	<h2> PUSH DEMO </h2>
	<p>说明：点击订阅后，后台会下发3次Notification消息，首次间隔10s，后两次间隔20s。</p>
	<button id="pushchang">PUSH环境切换</button>
	<br>
	<br>
	<button id="pushSubscribe">Push订阅</button>
	<br>
	<br>
	<!--<button id="pushInsquiry" disabled="disabled">取消订阅</button>
	<br>
	<br>
	<button id="pushInsquiry" disabled="disabled">订阅查询</button> -->
	
    <script>
		
		var delayTime;
		
		if(window.location.search != "?control") {
			window.location = "http://3g.qq.com"
		}
	
		function subscribeCallBack(str) {
			console.log("subscribeCallBack="+str);
			var json = JSON.parse(str);
			console.log("subscribeCallBack-callbackid="+json.callbackid+"|result="+json.result+"|userid="+json.userid+"|message="+json.message);
			alert("subscribeCallBack:"+str);
		}
	
		pushSubscribe.addEventListener('click', function (evt) {
			var str = {"appid":"10000", "callback":"subscribeCallBack", "callbackid":1};
			window.x5corepush.subscribe(JSON.stringify(str));
			delayTime = 50;
			delayRecovery();
		})
		
		function delayRecovery() {
			if (delayTime > 0) {
				document.getElementById("pushSubscribe").disabled = "disabled";
				document.getElementById("pushSubscribe").innerHTML = "请等待" + delayTime +"s后可再次点击";
				delayTime--;
				window.setTimeout(delayRecovery, 1000);
				return;
			}	
			document.getElementById("pushSubscribe").disabled = "";
			document.getElementById("pushSubscribe").innerHTML = "Push订阅";
		}
		
		pushchang.addEventListener('click', function (evt) {
			window.location = "qb://pushchange";
		})
    </script>
</body>
</html>